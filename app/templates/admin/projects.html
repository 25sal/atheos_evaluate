<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title></title>
     <script src="{{url_for('static', filename='codebase/dhtmlx.js')}}" type="text/javascript"></script>
    <link rel="STYLESHEET" type="text/css" href="{{url_for('static', filename='codebase/dhtmlx.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='bootstrap/css/bootstrap.min.css')}}">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i">
<link rel="stylesheet" href="{{url_for('static', filename='fonts/fontawesome-all.min.css')}}">
<link rel="stylesheet" href="{{url_for('static', filename='css/untitled.css')}}">
    <script src="{{url_for('static', filename='js/jquery.min.js')}}"></script>
    <script src="{{url_for('static', filename='bootstrap/js/bootstrap.min.js')}}"></script>
    <script src="{{url_for('static', filename='js/chart.min.js')}}"></script>
    <script src="{{url_for('static', filename='js/bs-init.js')}}"></script>
    <script src="{{url_for('static', filename='js/greencharge.js')}}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.js"></script>
    <script src="{{url_for('static', filename='js/theme.js')}}"></script>
 <style>
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            margin: 0px;
             background-color:grey;
        }
    </style>

</head>

<body>




</body>



<script type="text/javascript">
    window.dhx4.skin = 'dhx_web';

    var main_layout = new dhtmlXLayoutObject(document.body, '1C');

	var leftMenu = main_layout.cells('a');
	leftMenu.setText('My Admin');
	leftMenu.setWidth('200');
	var sidebar = leftMenu.attachSidebar({template: 'details', width: '200', icons_path: '/static/codebase/imgs_sidebar/',
        autohide: '', header: ''});
	sidebar.addItem({id: 'sidebar_item_0', text: 'New Projects', icon: 'sidebar_item_icon.png'});
    var sidebar_item_0 = sidebar.cells('sidebar_item_0');
    var list_ac_layout = sidebar_item_0.attachLayout('2U');
	var cell_form = list_ac_layout.cells('a');
    cell_form.hideHeader();
    let str = [
		{ type:"settings" , labelWidth:80, inputWidth:250, position:"absolute"  },
		{ type:"label" , name:"form_label_16", label:"Create a new project", width:250, labelWidth:250, labelLeft:150, labelTop:25  },
		{ type:"input" , name:"test_name", label:"Name", labelWidth:250, labelLeft:150, labelTop:75, inputLeft:150, inputTop:96,required:true  },
		{ type:"input" , name:"description", label:"Description", rows:"4", labelWidth:250, inputHeight:99, labelLeft:150, labelTop:125, inputLeft:150, inputTop:146  },
		{ type:"select" , name:"lang", label:"Language", labelWidth:75, inputWidth:75, labelLeft:150, labelTop:275, inputLeft:150, inputTop:296 ,options:[
                { value: "c", content: "1", label :"c"},
                {
                    value: "cpp",
                    content: "2",
                    label :"cpp"
                },

                {
                    value: "vhdl",
                    content: "3",
                    label :"vhdl"
                }
            ]},
    {type: "checkbox", value:"random", name:"randomtest", label: "Random Test", checked: false, labelWidth:100, inputWidth:100, labelLeft:225, labelTop:272, inputLeft:255, inputTop:293},

    //{type: "checkbox", value:"github", name:"github", label: "Github", checked: false, labelWidth:100, inputWidth:100, labelLeft:330, labelTop:272, inputLeft:340, inputTop:293},
		{ type:"button" , name:"create_button", label:"Create", value:"Create", width:"250", inputLeft:150, inputTop:325  },

    { type:"button" , name:"checkall", label:"Check All", value:"Check All", width:"250", inputLeft:80, inputTop:370  },
    { type:"button" , name:"clearall", label:"Clear All", value:"Uncheck All", width:"250", inputLeft:350, inputTop:370  }

	];
    
    var prj_form = cell_form.attachForm(str);

    var cell_grid = list_ac_layout.cells('b');
    cell_grid.hideHeader();
    var prj_grid = cell_grid.attachGrid();
    prj_grid.setImagePath('/static/codebase/imgs/dhxgrid_web/');
    prj_grid.setHeader(["Selected","User","First_name","Second_name", "Turno"]);
    prj_grid.setColTypes("ch,ro,ro,ro,ro");
    prj_grid.enableMultiselect(true);
    prj_grid.setColSorting('str,str,str,str,str');
    prj_grid.setInitWidths('*,*,*,*,*,*');
    prj_grid.init();
    prj_grid.load("/admin/list_prj_user");
    sidebar_item_0.setActive();

    prj_form.attachEvent("onButtonClick",function(id) {
        if (id == "checkall")
            prj_grid.checkAll();
        else if (id == "clearall")
            prj_grid.uncheckAll();
        else if (id == "create_button") {
            var checked = prj_grid.getCheckedRows(0);
            var elements = checked.split(",");
            jQuery.ajax({
                url: '/admin/create_projects',
                method: 'POST',
                data: {
                    users: elements,
                    test_name: prj_form.getItemValue('test_name', true),
                    random: prj_form.isItemChecked('randomtest'),
                    lang: prj_form.getItemValue('lang')

                        }
                     }).done(function (d) {
                        if (d == 0)
                            alert("Cancellazione progetto/i andata a buon fine !");
                        else
                            alert(d);
            });
        }
    });





	sidebar.addItem({id: 'sidebar_prj', text: 'List Projects', icon: 'sidebar_item_icon.png'});
	var sidebar_prj = sidebar.cells('sidebar_prj');

    var prj_list_layout = sidebar_prj.attachLayout('2E');

	var cell_prj_list = prj_list_layout.cells('a');
    cell_prj_list.hideHeader();

    var prj_list = cell_prj_list.attachGrid("gridbox");

    

	prj_list.setImagesPath('/static/codebase/imgs/');
	prj_list.setHeader(["id","user","testid","name","selected","change exercise"]);
	prj_list.setColTypes("ro,ro,ro,ro,ch,coro");
    jQuery.ajax({
        url: '/admin/exercise_list',
        method: 'GET',
         }).done(function (d) {
            console.log(d);
            //d=JSON.parse(d);
            combo = prj_list.getCombo(5);
            i=0;
            while(i < d.length)
            {
                combo.put(""+d[i],""+d[i]);
                i++;
            }
            
    });
    
    prj_list.setColumnIds("id","user","testid","name","selected","newex");
    prj_list.enableMultiselect(true);
	prj_list.setColSorting('int,str,str,str,str,int');
	prj_list.setInitWidths('*,*,*,*,*,*');
	
    prj_list.enableSmartRendering (true);
    prj_list.load("/admin/list_projects");
    prj_list.attachEvent("onCellChanged", function(rId,cInd,nValue){
        if(cInd==5){
         if(prj_list.cells(rId,2).getValue() != nValue){
            console.log(rId+" "+ cInd+" "+nValue);
            jQuery.ajax({
                url: '/admin/update_project',
                method: 'POST',
                data: {
                    id: rId,
                    exercise: nValue,
                    user: prj_list.cells(rId,1).getValue(),

                        }
                     }).done(function (d) {
                        if (d == 0)
                            alert("Failed Update !");
                       
            });
         }

        }

    });
    prj_list.init();
    var prj_form_cell = prj_list_layout.cells('b');
    prj_form_cell.hideHeader();
    var prj_str_form = [
      { type:"settings" , labelWidth:80, inputWidth:250, position:"absolute"  },
      { type:"button" , name:"form_button_1", label:"Delete selected", value:"Delete selected", width:"250", inputLeft:100, inputTop:25  },
      { type:"button" , name:"form_button_2", label:"Clear selection", value:"Clear selection", width:"250", inputLeft:550, inputTop:25  }
    ];
    var prj_del_form = prj_form_cell.attachForm(prj_str_form);
    prj_del_form.attachEvent("onButtonClick",function(id) {
        if (id == "form_button_2")
            grid_2.uncheckAll();
        else if (id == "form_button_1") {
            var checked = grid_2.getCheckedRows(2);
            var elements = checked.split(",");
            jQuery.ajax({
                url: '/admin/delete_projects',
                method: 'POST',
                data: {
                    var1: elements,
                    var2: username
                }
            }).done(function (d) {
                if (d == 0)
                    alert("Project Created!");
                else
                    alert(d);
            });
        }
    });








	sidebar.addItem({id: 'sidebar_item_delete', text: 'Delete All Projects', icon: 'sidebar_item_icon.png'});
	var sidebar_item_2 = sidebar.cells('sidebar_item_delete');
    var menu = leftMenu.attachMenu();
	menu.setIconsPath('/static/codebase/imgs/');

	menu.loadStruct('/static/data/admin/menu.xml');


    sidebar.attachEvent("onSelect",function(id) {

    });//end sidebare event


    </script>
</html>